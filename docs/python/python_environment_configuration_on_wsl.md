# WSL上でPythonの開発環境を構築する

## 環境

- Windows10 Home Version 1909
- Ubuntu 20.04.1 LTS(WSL1)
- Python 3.8.5

## コンセプト

- WSL上にPythonの開発環境を構築する
- Anacondaは使わない
- [venv](https://docs.python.org/ja/3/library/venv.html)を使った仮想環境を用いる
- Pythonパッケージは`pip`を使ってインストールする．`conda`は使わない
- プロジェクトディレクトリをGitHubで管理する
- Windows10にX Window Serverを立ててGUIも使えるようにする

## 作業

### 依存パッケージのインストール

Pythonや`pip`，その他必要なツールをインストールします．

X Window Serverを立てる予定が無い場合は，`python3-tk`は必要ありません．

```bash
sudo apt update && sudo apt upgrade
sudo apt install python3 python3-pip python3-venv python3-tk
```

### プロジェクトディレクトリの作成と環境構築

プロジェクトディレクトリを作成し，その中に移動します．
ここでは「python_practice」という名前のプロジェクトディレクトリを作成することにします．

```bash
mkdir python_practice
cd python_practice
```

プロジェクトディレクトリの中で，仮想環境を作るコマンドを実行します．

```bash
python3 -m venv env
```

仮想環境の構築に成功すると，プロジェクトディレクトリ直下に仮想環境が入ったディレクトリが作成されます．
このディレクトリの名前は，仮想環境を作成する際に実行したコマンドで，`venv`に渡した文字列になります．
上の例では「env」という文字列を引数として与えたので，プロジェクトディレクトリ直下には「env」という名前のディレクトリが生成されます．

Tips: 仮想環境が入ったディレクトリの名前は任意のものを付けることができますが，以下の理由から個人的には「env」を推奨します．

- ディレクトリの名前がこれで決定されること
- Pythonの`.gitignore`テンプレートには`env/`が記述されているため，Gitで管理するときに設定を追加する必要が無い
- 仮想環境のアクティベート(後述)のためのコマンドが長くなってしまう

### 仮想環境のアクティベート

作成した仮想環境をアクティブにするには，仮想環境ディレクトリの中のアクティベートスクリプトを読み込みます．
「env」という名前で仮想環境を作成した場合，以下のコマンドでアクティベートすることができます．

```bash
source env/bin/activate
```

仮想環境をアクティブにすると，ターミナルに表示されているユーザー名の左側に`(env)`と表示されます．
この表示がある間は仮想環境が展開され，`python`コマンドや`pip`コマンドが仮想環境ディレクトリ内のものに置き換わります．

試しにPythonのバージョンを確認してみましょう．

```console
(env)user@user:~/python_practice$ python --version
Python 3.8.5
```

仮想環境をアクティベートしている間は，`python`コマンドを実行しても仮想環境内のPythonが呼び出されます．
ここではPython3環境を作成した為，Python3.8.5が呼び出されます．

`venv`を使用して仮想環境を作成する場合は，システムにインストールされたPythonのバージョンと同じバージョンの環境しか作成されません．
今回はシステムのPythonのバージョンが3.8.5のため，仮想環境内のPythonのバージョンも3.8.5になっています．  
仮想環境内のバージョンを選択したい場合は，`pyenv`を使用する必要があります．

### パッケージのインストール

仮想環境内にPythonパッケージをインストールするには，`pip`コマンドを使用します．

仮想環境をアクティベートした状態で，`pip`コマンドを使ってパッケージをインストールします．
試しに`numpy`と`matplotlib`をインストールしてみましょう．

```console
(env)user@user:~/python_practice$ pip install numpy matplotlib
```

`pip`コマンドに`sudo`は付けません．
また，仮想環境をアクティベートしている間は`pip3`ではなく`pip`コマンドが使えます．

### 仮想環境のディアクティベート

仮想環境をディアクティベートするには，単に以下のコマンドを実行します．

```console
(env)user@user:~/python_practice$ deactivate
```

複数の仮想環境を構築して開発を行う場合は，どの環境がアクティブになっているかを確認するようにしましょう．

### インストールしたパッケージの情報を記録する

仮想環境内でインストールしたパッケージは，プロジェクトディレクトリ内の`env/`ディレクトリに保存されます．

Gitでプロジェクトを管理する場合，`env/`ディレクトリにはバイナリファイルが含まれるため，普通はGitの追跡から除外します．
その際，プロジェクトで使用されるパッケージのバージョン等の情報をGitで管理できるように，テキストファイルにこれらの情報を記録しておくのが通例となっています．

`pip`でインストールしたパッケージの一覧を表示するには，`pip freeze`を使用します．
オプションを指定しない場合，ターミナルに一覧が表示されます．

```console
(env)user@user:~/python_practice$ pip freeze
cycler==0.10.0
kiwisolver==1.3.1
matplotlib==3.3.3
numpy==1.19.4
Pillow==8.0.1
pyparsing==2.4.7
python-dateutil==2.8.1
scipy==1.5.4
six==1.15.0
```

この情報をテキストファイルに書き込みます．
テキストファイルの名前は「requirements.txt」とするのが慣例です．

```bash
pip freeze > requirements.txt
```

また，`pip`の`-r`オプションを使用することで，テキストファイルに記録したパッケージを一括でインストールすることができます．

```bash
pip install -r requirements.txt
```

こうすることで，プロジェクトで使用するパッケージのバージョンを記録することができ，複数のPCでも同じ環境で開発を行うことができます．
